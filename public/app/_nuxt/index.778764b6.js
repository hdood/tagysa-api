import{_ as L}from"./TextInput.607fee85.js";import{_ as M}from"./Button.vue.d78353b3.js";import{_ as z}from"./CropperModal.b6691953.js";import{G as E,J as G,x as J,l as o,w as K,o as j,f as H,i as s,u as a,z as n,P as c,t as U,C as P,T as N,F as O,K as Q}from"./entry.91eada8e.js";import{u as W}from"./auth.2ab643e9.js";import"./Icon.4fed1372.js";import"./config.fb914ae5.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./FileInput.056f0a4f.js";import"./transition.3f8552f5.js";import"./micro-task.fdb478dd.js";const X={class:"w-full my-10"},Y={class:"flex flex-col items-center gap-4"},Z={class:"avatar"},ee={class:"mask mask-squircle w-40"},te=["src"],se=s("h2",{class:"text-2xl font-medium text-base-content"},"Change password",-1),ae=["onSubmit"],oe={class:"mt-4"},ne=s("h2",{class:"text-2xl font-medium text-base-content"},"Delete account",-1),re=["onSubmit"],ye={__name:"index",setup(le){const B=E().provide.axios,v=G(),{user:_}=J(v),l=o(!1),r=o({}),g=o({}),i=o(_.value.name),y=o(!1),{changePassword:I,deleteAccount:A}=W(),f=o(""),u=o(""),p=o(""),w=o(""),x=o(!1),b=o(!1),D=async()=>{if(r.value={},!i.value){r.value.name="the name files is required";return}try{y.value=!0,await B.patch(`/api/users/${_.value.id}`,{name:i.value}),await v.getUser()}catch(d){console.log(d)}y.value=!1},R=async()=>{try{await v.updateUserImage(g.value),await v.getUser(),setTimeout(()=>l.value=!1,300)}catch(d){l.value=!1,alert(d)}};K(()=>g.value,async()=>await R());async function V(){if(u.value.length<8){r.value={newPassword:["password length must be longer than 8 characters"]};return}if(u.value!=p.value){r.value={cPassword:["password confirmation is not the same as the new password"]};return}x.value=!0,await I(f.value,u.value,p.value),x.value=!1}async function q(){b.value=!0,await A(w.value)&&Q().push("/"),b.value=!1}return(d,e)=>{var C,T,S,$,k;const m=L,h=M,F=z;return j(),H(O,null,[s("div",null,[s("div",X,[s("div",Y,[s("div",{class:"avatar",onClick:e[0]||(e[0]=t=>l.value=!0)},[s("div",Z,[s("div",ee,[s("img",{src:a(_).image},null,8,te)])])]),s("div",null,[s("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=t=>l.value=!0)},"Update")])]),n(m,{input:a(i),"onUpdate:input":e[2]||(e[2]=t=>c(i)?i.value=t:null),label:"Name",inputType:"text",error:(C=a(r))==null?void 0:C.name},null,8,["input","error"]),n(h,{type:"primary",class:"mt-3",onClick:D,loading:a(y)},{default:U(()=>[P(" Save ")]),_:1},8,["loading"])]),n(F,{show:a(l),onData:e[3]||(e[3]=t=>g.value=t),onClose:e[4]||(e[4]=t=>l.value=!1)},null,8,["show"]),se,s("form",{onSubmit:N(V,["prevent"])},[n(m,{input:a(f),"onUpdate:input":e[5]||(e[5]=t=>c(f)?f.value=t:null),label:"Current password",inputType:"password"},null,8,["input"]),n(m,{input:a(u),"onUpdate:input":e[6]||(e[6]=t=>c(u)?u.value=t:null),label:"New password",inputType:"password",error:(S=(T=a(r))==null?void 0:T.newPassword)==null?void 0:S[0]},null,8,["input","error"]),n(m,{input:a(p),"onUpdate:input":e[7]||(e[7]=t=>c(p)?p.value=t:null),label:"New password confirmation",error:(k=($=a(r))==null?void 0:$.cPassword)==null?void 0:k[0],inputType:"password"},null,8,["input","error"]),n(h,{type:"primary",class:"mt-3",loading:a(x)},{default:U(()=>[P("Update password")]),_:1},8,["loading"])],40,ae)]),s("div",oe,[ne,s("form",{onSubmit:N(q,["prevent"])},[n(m,{input:a(w),"onUpdate:input":e[8]||(e[8]=t=>c(w)?w.value=t:null),inputType:"password",label:"Password"},null,8,["input"]),n(h,{type:"danger",class:"mt-2",loading:a(b)},{default:U(()=>[P("Delete Account")]),_:1},8,["loading"])],40,re)])],64)}}};export{ye as default};
